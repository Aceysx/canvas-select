{"version":3,"file":"canvas-select.min.js","sources":["../src/shape/Shape.ts","../src/bridge.ts","../src/shape/Rect.ts","../src/shape/Polygon.ts","../src/shape/Dot.ts","../src/EventBus.ts","../src/index.ts"],"sourcesContent":["import { createUuid } from '../bridge'\nimport EventBus from '../EventBus'\n\nexport default class Shape {\n    public label: string = ''\n    public coor: any[] = []\n    public strokeStyle: string = ''\n    public fillStyle: string = ''\n    public labelFillStyle: string = ''\n    public labelFont: string = ''\n    public type: number // 形状\n    public active: boolean = false\n    public creating: boolean = false\n    public dragging: boolean = false\n    public index: number\n    public uuid: string = createUuid()\n    constructor(index: number, label: string, style: Record<string, any>, uuid: string) {\n        const { strokeStyle, fillStyle, labelFillStyle, labelFont } = style\n        this.index = index;\n        this.label = label;\n        this.strokeStyle = strokeStyle;\n        this.fillStyle = fillStyle;\n        this.labelFillStyle = labelFillStyle;\n        this.labelFont = labelFont;\n        if (uuid) this.uuid = uuid\n    }\n}\n","/**\n * 生成uuid\n * @returns\n */\nfunction createUuid(): string {\n    const s: any[] = [];\n    const hexDigits = '0123456789abcdef';\n    for (let i = 0; i < 36; i++) {\n        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);\n    }\n    s[14] = '4';\n    s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);\n    s[8] = s[13] = s[18] = s[23] = '-';\n    const uuid = s.join('');\n    return uuid;\n}\nexport { createUuid }","import { Point } from '../Types';\nimport Shape from './Shape';\n\nexport default class Rect extends Shape {\n  type: number = 1\n  constructor(coor: Point[], index?: number, label?: string, style = {}, uuid?: string) {\n    super(index, label, style, uuid)\n    this.coor = coor;\n  }\n  get ctrlsData() {\n    const [[x0, y0], [x1, y1]] = this.coor as Point[];\n    return [\n      [x0, y0],\n      [x0 + (x1 - x0) / 2, y0],\n      [x1, y0],\n      [x1, y0 + (y1 - y0) / 2],\n      [x1, y1],\n      [x0 + (x1 - x0) / 2, y1],\n      [x0, y1],\n      [x0, y0 + (y1 - y0) / 2],\n    ];\n  }\n}\n","import { Point } from '../Types';\nimport Shape from './Shape';\n\nexport default class Polygon extends Shape {\n  type: number = 2\n  constructor(coor: Point[], index?: number, label?: string, style = {}, uuid?: string) {\n    super(index, label, style, uuid)\n    this.coor = coor;\n  }\n  get ctrlsData() {\n    return this.coor.length > 2 ? this.coor : [];\n  }\n}\n","import { Point } from '../Types';\nimport Shape from './Shape';\n\nexport default class Dot extends Shape {\n    type: number = 3\n    constructor(coor: Point, index?: number, label?: string, style = {}, uuid?: string) {\n        super(index, label, style, uuid)\n        this.coor = coor;\n    }\n}\n","export default class EventBus {\n    public _eventTree: Record<string, any> = {}\n    /**\n   * 注册事件\n   * @param eventName 事件名称\n   * @param cb 回调方法\n   */\n    on(eventName: string, cb: Function) {\n        const fns = this._eventTree[eventName];\n        if (Array.isArray(fns)) {\n            fns.push(cb);\n        } else {\n            this._eventTree[eventName] = [cb];\n        }\n    }\n\n    /**\n     * 触发事件\n     * @param eventName 事件名称\n     * @param payload 传递参数\n     */\n    emit(eventName: string, ...payload: any) {\n        const fns = this._eventTree[eventName];\n        if (Array.isArray(fns)) {\n            fns.forEach((fn) => fn(...payload));\n        }\n    }\n\n    /**\n     * 注销事件\n     * @param eventName 事件名称\n     * @param cb 传递参数\n     */\n    off(eventName: string, cb: Function) {\n        const fns = this._eventTree[eventName];\n        const index = fns.find((fn: Function) => fn === cb);\n        if (Array.isArray(fns) && index) {\n            fns.splice(index, 1);\n        }\n    }\n}\n","import Rect from './shape/Rect';\nimport Polygon from './shape/Polygon';\nimport Dot from './shape/Dot';\nimport { Point } from './Types';\nimport EventBus from './EventBus';\n\nexport default class CanvasSelect extends EventBus {\n    lock: boolean = false // 只读模式\n\n    MIN_WIDTH: number = 10\n\n    MIN_HEIGHT: number = 10\n\n    strokeStyle = 'rgb(0, 0, 255)'\n\n    fillStyle = 'rgba(0, 0, 255,0.1)'\n\n    activeStrokeStyle = '#f00'\n\n    activeFillStyle = 'rgba(255, 0, 0,0.1)'\n\n    ctrlStrokeStyle = '#000'\n\n    ctrlFillStyle = '#fff'\n\n    ctrlRadius = 3\n\n    labelFillStyle = '#fff'\n\n    labelFont = '12px serif #000'\n\n    labelMaxLen = 5\n\n    WIDTH: number\n\n    HEIGHT: number\n\n    canvas: HTMLCanvasElement\n\n    ctx: CanvasRenderingContext2D\n\n    dataset: Array<Rect | Polygon | Dot> = []\n\n    offlineCanvas: HTMLCanvasElement\n\n    offlineCtx: CanvasRenderingContext2D\n\n    remmber: number[][] // 记录锚点距离\n\n    movePoint: Point // 记录鼠标位置\n\n    remmberOrigin: number[] = [0, 0] // 记录背景图鼠标位移\n\n    createType: number = 0 // 0 不创建，1 创建矩形，2 创建多边形，3 创建点\n\n    ctrlIndex: number = -1\n\n    cursor: string = 'auto'\n\n    image: HTMLImageElement = new Image()\n\n    imageLoaded: false\n\n    IMAGE_ORIGIN_WIDTH: number;\n\n    IMAGE_WIDTH: number;\n\n    IMAGE_ORIGIN_HEIGHT: number;\n\n    IMAGE_HEIGHT: number;\n\n    originX: number = 0; // 原点x\n\n    originY: number = 0; // 原点y\n\n    scaleStep: number = 0; // 缩放步长\n\n    canStart: Promise<any>\n\n    constructor(el: HTMLCanvasElement | string, imgSrc?: string) {\n        super()\n        const container = typeof el === 'string' ? document.querySelector(el) : el;\n        if (Object.prototype.toString.call(container).includes('HTMLCanvasElement')) {\n            this.canvas = container as HTMLCanvasElement;\n            this.ctx = this.canvas.getContext('2d');\n            this.WIDTH = this.canvas.clientWidth;\n            this.HEIGHT = this.canvas.clientHeight;\n            this.offlineCanvas = document.createElement('canvas');\n            this.offlineCanvas.width = this.WIDTH;\n            this.offlineCanvas.height = this.HEIGHT;\n            this.offlineCtx = this.offlineCanvas.getContext('2d');\n            this.initScreen();\n            if (imgSrc) {\n                this.setImage(imgSrc)\n            }\n        } else {\n            console.warn('HTMLCanvasElement is required!');\n        }\n    }\n\n    get activeShape() {\n        return this.dataset.find(x => x.active);\n    }\n\n    get scale() {\n        if (this.IMAGE_ORIGIN_WIDTH && this.IMAGE_WIDTH) {\n            return this.IMAGE_WIDTH / this.IMAGE_ORIGIN_WIDTH;\n        }\n        return 1;\n    }\n    /**\n     * 初始化\n     */\n    initScreen() {\n        this.canvas.style.userSelect = 'none';\n        this.canStart = new Promise((resolve) => {\n            if (this.imageLoaded) {\n                resolve(true)\n            } else {\n                this.image.addEventListener('load', () => {\n                    this.emit('load');\n                    this.IMAGE_ORIGIN_WIDTH = this.IMAGE_WIDTH = this.image.width;\n                    this.IMAGE_ORIGIN_HEIGHT = this.IMAGE_HEIGHT = this.image.height;\n                    this.fitZoom();\n                    resolve(true)\n                });\n            }\n        })\n\n        this.canvas.addEventListener('contextmenu', (e) => {\n            if (this.lock) return;\n            e.preventDefault();\n        });\n        this.canvas.addEventListener('mousewheel', (e: WheelEvent) => {\n            if (this.lock) return;\n            e.preventDefault();\n            this.setScale(e.deltaY < 0);\n            const offsetX = Math.round(e.offsetX / this.scale);\n            const offsetY = Math.round(e.offsetY / this.scale);\n            this.movePoint = [offsetX, offsetY];\n            this.update()\n        });\n        this.canvas.addEventListener('mousedown', (e: MouseEvent) => {\n            if (this.lock) return;\n            const offsetX = Math.round(e.offsetX / this.scale);\n            const offsetY = Math.round(e.offsetY / this.scale);\n            const mousePoint: Point = [e.offsetX, e.offsetY];\n            if (e.buttons === 2) { // 鼠标右键\n                this.remmberOrigin = [e.offsetX - this.originX, e.offsetY - this.originY];\n            } else if (e.buttons === 1) { // 鼠标左键\n                // 点击到控制点\n                // @ts-ignore\n                const ctrls = this.activeShape?.ctrlsData || [];\n                this.ctrlIndex = ctrls.findIndex((coor: Point) => this.isPointInCircle(mousePoint, coor, this.ctrlRadius));\n                if (this.ctrlIndex > -1) {\n                    const [x0, y0] = ctrls[this.ctrlIndex];\n                    this.remmber = [[offsetX - x0, offsetY - y0]];\n                    return;\n                }\n                // 是否点击到形状\n                const [hitShapeIndex, hitShape] = this.hitOnShape(mousePoint);\n                // 是否正在创建多边形\n                const oncreating = this.activeShape?.type === 2 && this.activeShape.creating;\n                if (oncreating) {\n                    // 多边形新增点\n                    if (this.isInBackground(e)) {\n                        const pShape = this.activeShape as Polygon;\n                        const [x, y] = pShape.coor[pShape.coor.length - 1];\n                        if (x !== offsetX && y !== offsetY) {\n                            const nx = Math.round(offsetX - this.originX / this.scale)\n                            const ny = Math.round(offsetY - this.originY / this.scale)\n                            pShape.coor.push([nx, ny]);\n                            this.update();\n                        }\n                    }\n                } else if (hitShapeIndex > -1) {\n                    this.emit('select', hitShape)\n                    this.dataset.forEach((item, i) => {\n                        item.active = i === hitShapeIndex;\n                    });\n                    hitShape.dragging = true;\n                    this.dataset.splice(hitShapeIndex, 1);\n                    this.dataset.push(hitShape);\n                    this.remmber = [];\n                    if (hitShape.type === 3) {\n                        const [x, y] = hitShape.coor;\n                        this.remmber = [[offsetX - x, offsetY - y]];\n                    } else {\n                        hitShape.coor.forEach((pt: any) => {\n                            this.remmber.push([offsetX - pt[0], offsetY - pt[1]]);\n                        });\n                    }\n                    this.update();\n                } else if (this.createType > 0 && this.isInBackground(e)) {\n                    // 创建矩形/多边形\n                    let newShape;\n                    const nx = Math.round(offsetX - this.originX / this.scale)\n                    const ny = Math.round(offsetY - this.originY / this.scale)\n                    const curPoint: Point = [nx, ny];\n                    if (this.createType === 1) {\n                        newShape = new Rect([curPoint, curPoint], this.dataset.length);\n                        newShape.creating = true;\n                    } else if (this.createType === 2) {\n                        newShape = new Polygon([curPoint], this.dataset.length);\n                        newShape.creating = true;\n                    } else if (this.createType === 3) {\n                        newShape = new Dot(curPoint, this.dataset.length);\n                        this.emit('add', newShape)\n                    }\n                    this.dataset.forEach((sp) => { sp.active = false; });\n                    newShape.active = true;\n                    this.dataset.push(newShape);\n                    this.emit('updated', newShape)\n                    this.update();\n                } else if (this.activeShape) {\n                    this.activeShape.active = false;\n                    this.update();\n                }\n            }\n        });\n        this.canvas.addEventListener('mousemove', (e: MouseEvent) => {\n            if (this.lock) return;\n            const offsetX = Math.round(e.offsetX / this.scale);\n            const offsetY = Math.round(e.offsetY / this.scale);\n            // 记录鼠标位置\n            this.movePoint = [offsetX, offsetY];\n            if (e.buttons === 2 && e.which === 3) {\n                // 拖动背景\n                this.originX = Math.round(e.offsetX - this.remmberOrigin[0]);\n                this.originY = Math.round(e.offsetY - this.remmberOrigin[1]);\n                this.update();\n            } else if (e.buttons === 1 && this.activeShape) {\n                if (this.ctrlIndex > -1 && this.isInBackground(e)) {\n                    const [[x, y]] = this.remmber;\n                    // resize矩形\n                    if (this.activeShape.type === 1) {\n                        const [[x0, y0], [x1, y1]] = (this.activeShape as Rect).coor;\n                        let coor: Point[] = [];\n                        switch (this.ctrlIndex) {\n                            case 0:\n                                coor = [[offsetX - x, offsetY - y], [x1, y1]];\n                                break;\n                            case 1:\n                                coor = [[x0, offsetY - y], [x1, y1]];\n                                break;\n                            case 2:\n                                coor = [[x0, offsetY - y], [offsetX - x, y1]];\n                                break;\n                            case 3:\n                                coor = [[x0, y0], [offsetX - x, y1]];\n                                break;\n                            case 4:\n                                coor = [[x0, y0], [offsetX - x, offsetY - y]];\n                                break;\n                            case 5:\n                                coor = [[x0, y0], [x1, offsetY - y]];\n                                break;\n                            case 6:\n                                coor = [[offsetX - x, y0], [x1, offsetY - y]];\n                                break;\n                            case 7:\n                                coor = [[offsetX - x, y0], [x1, y1]];\n                                break;\n                            default:\n                                break;\n                        }\n                        const [[a0, b0], [a1, b1]] = coor;\n                        if ((a1 - a0) >= this.MIN_WIDTH && (b1 - b0) >= this.MIN_HEIGHT) {\n                            this.activeShape.coor = coor;\n                        } else {\n                            this.emit('error', `宽不能小于${this.MIN_WIDTH},高不能小于${this.MIN_HEIGHT}。`);\n                        }\n                    } else if (this.activeShape.type === 2) {\n                        const nx = Math.round(offsetX - this.originX / this.scale)\n                        const ny = Math.round(offsetY - this.originY / this.scale)\n                        const newPoint = [nx, ny]\n                        this.activeShape.coor.splice(this.ctrlIndex, 1, newPoint);\n                    }\n                } else if (this.activeShape.dragging) { // 拖拽\n                    let coor = [];\n                    let noLimit = true\n                    const w = this.IMAGE_ORIGIN_WIDTH || this.WIDTH;\n                    const h = this.IMAGE_ORIGIN_HEIGHT || this.HEIGHT;\n                    if (this.activeShape.type === 3) {\n                        const [t1, t2] = this.remmber[0];\n                        const x = offsetX - t1;\n                        const y = offsetY - t2;\n                        if (x < 0 || x > w || y < 0 || y > h) noLimit = false;\n                        coor = [x, y];\n                    } else {\n                        for (let i = 0; i < this.activeShape.coor.length; i++) {\n                            const tar = this.remmber[i];\n                            const x = offsetX - tar[0];\n                            const y = offsetY - tar[1];\n                            if (x < 0 || x > w || y < 0 || y > h) noLimit = false\n                            coor.push([x, y]);\n                        }\n                    }\n                    if (noLimit) this.activeShape.coor = coor;\n                } else if (this.activeShape.creating && this.activeShape.type === 1 && this.isInBackground(e)) {\n                    // 创建矩形\n                    const x = Math.round(offsetX - this.originX / this.scale);\n                    const y = Math.round(offsetY - this.originY / this.scale);\n                    this.activeShape.coor.splice(1, 1, [x, y]);\n                }\n                this.emit('updated', this.activeShape)\n                this.update();\n            } else if (this.activeShape?.type === 2 && (this.activeShape as Polygon)?.creating) {\n                // 多边形添加点\n                this.update();\n            }\n        });\n        this.canvas.addEventListener('mouseup', (e) => {\n            if (this.lock) return;\n            this.remmber = [];\n            if (this.activeShape) {\n                this.activeShape.dragging = false;\n                if (this.activeShape.creating && this.activeShape.type === 1) {\n                    const [[x0, y0], [x1, y1]] = this.activeShape.coor;\n                    if (Math.abs(x0 - x1) < this.MIN_WIDTH || Math.abs(y0 - y1) < this.MIN_HEIGHT) {\n                        this.dataset.pop();\n                        this.emit('error', `宽不能小于${this.MIN_WIDTH},高不能小于${this.MIN_HEIGHT}`);\n                    } else {\n                        this.activeShape.coor = [[Math.min(x0, x1), Math.min(y0, y1)], [Math.max(x0, x1), Math.max(y0, y1)]];\n                        this.activeShape.creating = false;\n                        this.emit('add', this.activeShape);\n                    }\n                    this.update();\n                }\n            }\n        });\n        this.canvas.addEventListener('dblclick', () => {\n            if (this.lock) return;\n            if (this.activeShape?.type === 2) {\n                if (this.activeShape.coor.length > 2) {\n                    this.emit('add', this.activeShape);\n                    this.emit('updated', this.activeShape);\n                    this.activeShape.creating = false;\n                    this.update();\n                }\n            }\n        });\n        document.body.addEventListener('keyup', (e: KeyboardEvent) => {\n            if (this.lock) return;\n            if (this.activeShape) {\n                if (this.activeShape.type === 2 && e.key === 'Escape') {\n                    if (this.activeShape.coor.length > 1 && this.activeShape.creating) {\n                        this.activeShape.coor.pop();\n                    } else {\n                        this.deleteByIndex(this.activeShape.index);\n                    }\n                    this.update();\n                } else if (e.key === 'Backspace') {\n                    this.deleteByIndex(this.activeShape.index);\n                }\n            }\n        });\n    }\n    /**\n     * 添加/切换图片\n     * @param url 图片链接\n     */\n    setImage(url: string) {\n        this.imageLoaded = false\n        this.image.src = url\n    }\n    /**\n     * 设置数据\n     * @param data Array\n     */\n    async setData(data: any[]) {\n        let initdata: any[] = []\n        try {\n            await this.canStart\n            data.forEach((item, index) => {\n                if (Object.prototype.toString.call(item).indexOf('Object') > -1) {\n                    const { label, type, coor, strokeStyle, fillStyle, labelFillStyle, labelFont, uuid } = item;\n                    const style = { strokeStyle, fillStyle, labelFillStyle, labelFont }\n                    let shape\n                    switch (type) {\n                        case 1:\n                            shape = new Rect(coor, index, label, style, uuid);\n                            break;\n                        case 2:\n                            shape = new Polygon(coor, index, label, style, uuid);\n                            break;\n                        case 3:\n                            shape = new Dot(coor, index, label, style, uuid);\n                            break;\n                        default:\n                            break;\n                    }\n                    initdata.push(shape);\n                } else {\n                    this.emit('error', `${item} in data must be an enumerable Object.`);\n                }\n            });\n            this.dataset = initdata\n            this.update();\n        } catch (error) {\n            this.emit('error', error);\n        }\n    }\n    /**\n     * 判断是否在标注实例上\n     * @param mousePoint 点击位置\n     * @returns \n     */\n    hitOnShape(mousePoint: Point): [number, Rect | Polygon | Dot] {\n        let hitShapeIndex = -1;\n        const hitShape = this.dataset.reduceRight((target, shape, i) => {\n            if (!target) {\n                if (\n                    (shape.type === 3 && this.isPointInCircle(mousePoint, shape.coor as Point, 3))\n                    || (shape.type === 1 && this.isPointInRect(mousePoint, (shape as Rect).coor))\n                    || (shape.type === 2 && this.isPointInPolygon(mousePoint, (shape as Polygon).coor))\n                ) {\n                    hitShapeIndex = i;\n                    target = shape;\n                }\n            }\n            return target;\n        }, null);\n        return [hitShapeIndex, hitShape];\n    }\n\n    /**\n     * 判断鼠标是否在背景图内部\n     * @param e MouseEvent\n     * @returns 布尔值\n     */\n    isInBackground(e: MouseEvent): boolean {\n        const offsetX = e.offsetX / this.scale;\n        const offsetY = e.offsetY / this.scale;\n        return offsetX >= this.originX / this.scale && offsetY >= this.originY / this.scale\n            && offsetX <= this.originX / this.scale + this.IMAGE_ORIGIN_WIDTH && offsetY <= this.originY / this.scale + this.IMAGE_ORIGIN_HEIGHT;\n    }\n    /**\n     * 判断是否在矩形内\n     * @param point 坐标\n     * @param coor 区域坐标\n     * @returns 布尔值\n     */\n    isPointInRect(point: Point, coor: Point[]): boolean {\n        const [x, y] = point;\n        const [[x0, y0], [x1, y1]] = coor.map((a) => a.map((b) => b * this.scale));\n        return x0 + this.originX <= x && x <= x1 + this.originX && y0 + this.originY <= y && y <= y1 + this.originY;\n    }\n    /**\n     * 判断是否在多边形内\n     * @param point 坐标\n     * @param coor 区域坐标\n     * @returns 布尔值\n     */\n    isPointInPolygon(point: Point, coor: Point[]): boolean {\n        this.offlineCtx.save();\n        this.offlineCtx.clearRect(0, 0, this.WIDTH, this.HEIGHT);\n        this.offlineCtx.translate(this.originX, this.originY);\n        this.offlineCtx.beginPath();\n        coor.forEach((pt, i) => {\n            const [x, y] = pt.map((a) => Math.round(a * this.scale));\n            if (i === 0) {\n                this.offlineCtx.moveTo(x, y);\n            } else {\n                this.offlineCtx.lineTo(x, y);\n            }\n        });\n        this.offlineCtx.closePath();\n        this.offlineCtx.fill();\n        const areaData = this.offlineCtx.getImageData(0, 0, this.WIDTH, this.HEIGHT);\n        const index = (point[1] - 1) * this.WIDTH * 4 + point[0] * 4;\n        this.offlineCtx.restore();\n        return areaData.data[index + 3] !== 0;\n    }\n    /**\n     * 判断是否在圆内\n     * @param point 坐标\n     * @param center 圆心\n     * @param r 半径\n     * @returns 布尔值\n     */\n    isPointInCircle(point: Point, center: Point, r: number): boolean {\n        const [x, y] = point;\n        const [x0, y0] = center.map((a) => a * this.scale);\n        const distance = Math.sqrt((x0 + this.originX - x) ** 2 + (y0 + this.originY - y) ** 2);\n        return distance <= r;\n    }\n    /**\n     * 绘制矩形\n     * @param shape 标注实例\n     * @returns \n     */\n    drawRect(shape: Rect) {\n        if (shape.coor.length !== 2) return;\n        const { labelFillStyle, labelFont, strokeStyle, fillStyle, active, creating, coor, label } = shape\n        const [[x0, y0], [x1, y1]] = coor.map((a: Point) => a.map((b) => Math.round(b * this.scale)));\n        this.ctx.save();\n        this.ctx.fillStyle = fillStyle || this.fillStyle;\n        this.ctx.strokeStyle = (active || creating) ? this.activeStrokeStyle : (strokeStyle || this.strokeStyle);\n        const w = x1 - x0;\n        const h = y1 - y0;\n        this.ctx.strokeRect(x0, y0, w, h);\n        if (!creating) this.ctx.fillRect(x0, y0, w, h);\n        this.ctx.restore();\n        this.drawLabel(coor[0], label, labelFillStyle, labelFont);\n    }\n    /**\n     * 绘制多边形\n     * @param shape 标注实例\n     */\n    drawPolygon(shape: Polygon) {\n        const { labelFillStyle, labelFont, strokeStyle, fillStyle, active, creating, coor, label } = shape\n        this.ctx.save();\n        this.ctx.fillStyle = fillStyle || this.fillStyle;\n        this.ctx.strokeStyle = (active || creating) ? this.activeStrokeStyle : (strokeStyle || this.strokeStyle);\n        this.ctx.beginPath();\n        coor.forEach((el: Point, i) => {\n            const [x, y] = el.map((a) => Math.round(a * this.scale));\n            if (i === 0) {\n                this.ctx.moveTo(x, y);\n            } else {\n                this.ctx.lineTo(x, y);\n            }\n        });\n        if (creating) {\n            const [x, y] = this.movePoint.map((a) => Math.round(a * this.scale));\n            this.ctx.lineTo(x - this.originX, y - this.originY);\n        } else if (coor.length > 2) {\n            this.ctx.closePath();\n        }\n        this.ctx.fill();\n        this.ctx.stroke();\n        this.ctx.restore();\n        this.drawLabel(coor[0], label, labelFillStyle, labelFont);\n    }\n    /**\n     * 绘制点\n     * @param shape 标注实例\n     */\n    drawDot(shape: Dot) {\n        const { labelFillStyle, labelFont, strokeStyle, fillStyle, active, coor, label } = shape\n        const [x, y] = coor.map((a) => a * this.scale);\n        this.ctx.save();\n        this.ctx.fillStyle = fillStyle || this.ctrlFillStyle;\n        this.ctx.strokeStyle = active ? this.activeStrokeStyle : (strokeStyle || this.strokeStyle);\n        this.ctx.beginPath();\n        this.ctx.arc(x, y, this.ctrlRadius, 0, 2 * Math.PI, true);\n        this.ctx.fill();\n        this.ctx.arc(x, y, this.ctrlRadius, 0, 2 * Math.PI, true);\n        this.ctx.stroke();\n        this.ctx.restore();\n        this.drawLabel(coor as Point, label, labelFillStyle, labelFont);\n    }\n    /**\n     * 绘制控制点\n     * @param point 坐标\n     */\n    drawCtrl(point: Point) {\n        const [x, y] = point.map((a) => a * this.scale);\n        this.ctx.save();\n        this.ctx.beginPath();\n        this.ctx.fillStyle = this.ctrlFillStyle;\n        this.ctx.strokeStyle = this.ctrlStrokeStyle;\n        this.ctx.arc(x, y, this.ctrlRadius, 0, 2 * Math.PI, true);\n        this.ctx.fill();\n        this.ctx.arc(x, y, this.ctrlRadius, 0, 2 * Math.PI, true);\n        this.ctx.stroke();\n        this.ctx.restore();\n    }\n    /**\n     * 绘制控制点列表\n     * @param shape 标注实例\n     */\n    drawCtrlList(shape: Rect | Polygon) {\n        shape.ctrlsData.forEach((point) => {\n            this.drawCtrl(point);\n        });\n    }\n    /**\n     * 绘制label\n     * @param point 位置\n     * @param label 文本\n     */\n    drawLabel(point: Point, label: string = '', labelFillStyle = '', labelFont = '') {\n        if (label.length) {\n            const newStr = label.length < this.labelMaxLen + 1 ? label : (`${label.substr(0, this.labelMaxLen)}...`);\n            const text = this.ctx.measureText(newStr);\n            const [x, y] = point.map((a) => a * this.scale);\n            const toleft = (this.IMAGE_ORIGIN_WIDTH - point[0]) < (text.width + 4) / this.scale;\n            const toTop = (this.IMAGE_ORIGIN_HEIGHT - point[1]) < 16 / this.scale;\n            this.ctx.save();\n            this.ctx.fillStyle = labelFillStyle || this.labelFillStyle;\n            this.ctx.fillRect(toleft ? (x - text.width - 3) : (x + 1), toTop ? (y - 15) : y + 1, text.width + 4, 16);\n            this.ctx.font = labelFont || this.labelFont;\n            this.ctx.strokeText(newStr, toleft ? (x - text.width - 2) : (x + 2), toTop ? (y - 4) : y + 12, 80);\n            this.ctx.restore();\n        }\n    }\n\n    /**\n     * 绘制背景图片\n     */\n    paintImage() {\n        this.ctx.drawImage(this.image, 0, 0, this.IMAGE_WIDTH, this.IMAGE_HEIGHT);\n    }\n\n    clear() {\n        this.ctx.clearRect(0, 0, this.WIDTH, this.HEIGHT);\n    }\n\n    /**\n     * 更新画布\n     */\n    update() {\n        this.ctx.save();\n        this.clear();\n        this.ctx.translate(this.originX, this.originY);\n        this.paintImage();\n        this.dataset.forEach((shape) => {\n            switch (shape.type) {\n                case 1:\n                    this.drawRect(shape as Rect);\n                    break;\n                case 2:\n                    this.drawPolygon(shape as Polygon);\n                    break;\n                case 3:\n                    this.drawDot(shape as Dot);\n                    break;\n                default:\n                    break;\n            }\n        });\n        if (this.activeShape && [1, 2].includes(this.activeShape.type)) {\n            this.drawCtrlList(this.activeShape as Rect | Polygon);\n        }\n        this.ctx.restore();\n    }\n\n    /**\n     * 删除指定矩形\n     * @param index number\n     */\n    deleteByIndex(index: number) {\n        const num = this.dataset.findIndex((x) => x.index === index);\n        if (num > -1) {\n            this.emit('delete', this.dataset[num]);\n            this.dataset.splice(num, 1);\n            this.dataset.forEach((item, i) => { item.index = i; });\n            this.update();\n        }\n    }\n\n    /**\n     * 计算缩放步长\n     * @param init 是否为init\n     */\n    calcStep(init?: boolean) {\n        if (init) {\n            this.scaleStep = 100;\n            this.setScale(false);\n        }\n        if (this.IMAGE_WIDTH > this.WIDTH || this.IMAGE_HEIGHT > this.HEIGHT) {\n            this.setScale(false);\n            this.calcStep();\n        }\n    }\n\n    /**\n     * 缩放\n     * @param type true放大，false，缩小\n     */\n    setScale(type: boolean) {\n        if (this.lock) return;\n        if ((!type && this.IMAGE_WIDTH <= 20) || (type && this.IMAGE_WIDTH >= this.WIDTH * 100)) return;\n        if (type) { this.scaleStep++; } else { this.scaleStep--; }\n        const abs = Math.abs(this.scaleStep);\n        const width = this.IMAGE_WIDTH;\n        this.IMAGE_WIDTH = Math.round(this.IMAGE_ORIGIN_WIDTH * (this.scaleStep >= 0 ? 1.05 : 0.95) ** abs);\n        this.IMAGE_HEIGHT = Math.round(this.IMAGE_ORIGIN_HEIGHT * (this.scaleStep >= 0 ? 1.05 : 0.95) ** abs);\n        this.stayPosition(this.IMAGE_WIDTH / width);\n        this.update();\n    }\n\n    /**\n     * 适配背景图\n     */\n    fitZoom() {\n        this.calcStep(true);\n        if (this.IMAGE_HEIGHT / this.IMAGE_WIDTH >= this.HEIGHT / this.WIDTH) {\n            this.IMAGE_WIDTH = this.IMAGE_ORIGIN_WIDTH / (this.IMAGE_ORIGIN_HEIGHT / this.HEIGHT);\n            this.IMAGE_HEIGHT = this.HEIGHT;\n        } else {\n            this.IMAGE_WIDTH = this.WIDTH;\n            this.IMAGE_HEIGHT = this.IMAGE_ORIGIN_HEIGHT / (this.IMAGE_ORIGIN_WIDTH / this.WIDTH);\n        }\n        this.originX = (this.WIDTH - this.IMAGE_WIDTH) / 2;\n        this.originY = (this.HEIGHT - this.IMAGE_HEIGHT) / 2;\n        this.update();\n    }\n\n    /**\n     * 保持缩放中心\n     * @param scale nummer\n     */\n    stayPosition(scale: number) {\n        this.originX = this.WIDTH / 2 - (this.WIDTH / 2 - this.originX) * scale;\n        this.originY = this.HEIGHT / 2 - (this.HEIGHT / 2 - this.originY) * scale;\n    }\n}\n\n"],"names":["Shape","index","label","style","uuid","this","coor","strokeStyle","fillStyle","labelFillStyle","labelFont","active","creating","dragging","s","hexDigits","i","substr","Math","floor","random","join","createUuid","Rect","_super","_this","call","type","__extends","Object","defineProperty","prototype","get","_a","__read","_b","x0","y0","_c","x1","y1","Polygon","length","Dot","EventBus","_eventTree","on","eventName","cb","fns","Array","isArray","push","emit","payload","_i","arguments","forEach","fn","apply","__spreadArray","off","find","splice","CanvasSelect","el","imgSrc","lock","MIN_WIDTH","MIN_HEIGHT","activeStrokeStyle","activeFillStyle","ctrlStrokeStyle","ctrlFillStyle","ctrlRadius","labelMaxLen","dataset","remmberOrigin","createType","ctrlIndex","cursor","image","Image","originX","originY","scaleStep","container","document","querySelector","toString","includes","canvas","ctx","getContext","WIDTH","clientWidth","HEIGHT","clientHeight","offlineCanvas","createElement","width","height","offlineCtx","initScreen","setImage","console","warn","x","IMAGE_ORIGIN_WIDTH","IMAGE_WIDTH","userSelect","canStart","Promise","resolve","imageLoaded","addEventListener","IMAGE_ORIGIN_HEIGHT","IMAGE_HEIGHT","fitZoom","e","preventDefault","setScale","deltaY","offsetX","round","scale","offsetY","movePoint","update","mousePoint","buttons","ctrls","activeShape","ctrlsData","findIndex","isPointInCircle","remmber","_d","hitOnShape","hitShapeIndex_1","hitShape","isInBackground","pShape","_e","y","nx","ny","item","_f","pt","newShape","curPoint","sp","which","_g","_h","_j","a0","b0","_k","a1","b1","concat","newPoint","noLimit","w","h","_l","t1","tar","abs","pop","min","max","body","key","deleteByIndex","url","src","setData","data","initdata","sent","indexOf","shape","error_1","hitShapeIndex","reduceRight","target","isPointInRect","isPointInPolygon","point","map","a","b","save","clearRect","translate","beginPath","moveTo","lineTo","closePath","fill","areaData","getImageData","restore","center","r","sqrt","pow","drawRect","strokeRect","fillRect","drawLabel","drawPolygon","stroke","drawDot","arc","PI","drawCtrl","drawCtrlList","newStr","text","measureText","toleft","toTop","font","strokeText","paintImage","drawImage","clear","num","calcStep","init","stayPosition"],"mappings":"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"}